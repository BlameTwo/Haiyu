<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Haiyu.Pages.ColorFullGame"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ani="using:CommunityToolkit.WinUI.Animations"
    xmlns:b="using:CommunityToolkit.WinUI.Behaviors"
    xmlns:behaviors="using:Haiyu.Behaviors"
    xmlns:convert="using:Haiyu.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:enum="using:Haiyu.Models.Enums"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:local="using:Haiyu.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="using:Haiyu.Models.ColorFullGame"
    xmlns:ui="using:Haiyu.Controls"
    xmlns:ui1="using:CommunityToolkit.WinUI.Controls"
    mc:Ignorable="d">
    <Page.Resources>
        <convert:GameFullModeConverter x:Key="DotDyeingGameFullModeConverter" ParentMode="DotDyeing" />
        <convert:GameFullModeConverter x:Key="DyeingGameFullModeConverter" ParentMode="Dyeing" />
    </Page.Resources>
    <Grid x:Name="grid">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <ui:TitleBar
            x:Name="title"
            IsExtendsContentIntoTitleBar="True"
            TitleMode="Tall">
            <ui:TitleBar.Title>
                <TextBlock
                    Margin="15,7,0,0"
                    VerticalAlignment="Center"
                    FontFamily="{ThemeResource DefaultFont}"
                    Text="溢彩画编辑器" />
            </ui:TitleBar.Title>
            <ui:TitleBar.Header>
                <StackPanel Orientation="Horizontal">

                    <MenuBar
                        Margin="5,5,0,0"
                        FontFamily="{ThemeResource DefaultFont}"
                        FontSize="12">
                        <MenuBarItem
                            Title="文件"
                            FontFamily="{ThemeResource DefaultFont}"
                            FontSize="12">
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.NewFileCommand}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                Text="新文件">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="NewFolder" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.OpenGameCommand}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                Text="打开">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="OpenFile" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.SaveGameCommand}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                Text="保存">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="Save" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.SaveAsGameCommand}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                Text="另存为">
                                <MenuFlyoutItem.Icon>
                                    <SymbolIcon Symbol="Save" />
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuBarItem>
                        <MenuBarItem Title="生成棋盘">
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.Generator8X12Command}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                Text="8X12" />
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.Generator6X6Command}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                Text="6X6" />
                            <MenuFlyoutItem
                                Command="{x:Bind ViewModel.Generator10X10Command}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                Text="10X10" />
                        </MenuBarItem>
                        <MenuBarItem Title="染色切换">
                            <RadioMenuFlyoutItem
                                Command="{x:Bind ViewModel.SetGameModeCommand}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                GroupName="GameMode"
                                IsChecked="{x:Bind ViewModel.Mode, Mode=OneWay, Converter={StaticResource DotDyeingGameFullModeConverter}}"
                                Text="点染模式">
                                <RadioMenuFlyoutItem.CommandParameter>
                                    <enum:ColorGameEditMode>DotDyeing</enum:ColorGameEditMode>
                                </RadioMenuFlyoutItem.CommandParameter>
                            </RadioMenuFlyoutItem>
                            <RadioMenuFlyoutItem
                                Command="{x:Bind ViewModel.SetGameModeCommand}"
                                FontFamily="{ThemeResource DefaultFont}"
                                FontSize="12"
                                GroupName="GameMode"
                                IsChecked="{x:Bind ViewModel.Mode, Mode=OneWay, Converter={StaticResource DyeingGameFullModeConverter}}"
                                Text="染色模式">
                                <RadioMenuFlyoutItem.CommandParameter>
                                    <enum:ColorGameEditMode>Dyeing</enum:ColorGameEditMode>
                                </RadioMenuFlyoutItem.CommandParameter>
                            </RadioMenuFlyoutItem>
                        </MenuBarItem>
                    </MenuBar>

                </StackPanel>
            </ui:TitleBar.Header>
        </ui:TitleBar>
        <Grid Grid.Row="1" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="550" />
                <ColumnDefinition Width="420" />
            </Grid.ColumnDefinitions>
            <Border
                Padding="15"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource AccentAAFillColorDefaultBrush}"
                BorderThickness="2"
                CornerRadius="5">
                <Viewbox HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ItemsView
                        IsItemInvokedEnabled="True"
                        ItemInvoked="ItemsView_ItemInvoked"
                        ItemsSource="{x:Bind ViewModel.GameGrid, Mode=OneWay}"
                        SelectionMode="None">
                        <ItemsView.ItemTransitionProvider>
                            <LinedFlowLayoutItemCollectionTransitionProvider />
                        </ItemsView.ItemTransitionProvider>
                        <ItemsView.ItemTemplate>
                            <DataTemplate x:DataType="model:ColorCell">

                                <ItemContainer>

                                    <Grid
                                        x:Name="grid"
                                        Width="60"
                                        Height="60"
                                        Background="{x:Bind CurrentColor, Mode=OneWay}"
                                        BorderBrush="Transparent"
                                        BorderThickness="2"
                                        CornerRadius="10">
                                        <Grid.BackgroundTransition>
                                            <BrushTransition />
                                        </Grid.BackgroundTransition>
                                        <FontIcon
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            FontFamily="{ThemeResource FluentIcon}"
                                            FontSize="20"
                                            Foreground="White"
                                            Glyph="&#xE72E;"
                                            Visibility="{x:Bind IsStone, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                                        <Grid.Transitions>
                                            <TransitionCollection>
                                                <RepositionThemeTransition />
                                            </TransitionCollection>
                                        </Grid.Transitions>
                                    </Grid>
                                </ItemContainer>
                            </DataTemplate>
                        </ItemsView.ItemTemplate>
                        <ItemsView.Layout>
                            <UniformGridLayout
                                MaximumRowsOrColumns="{x:Bind ViewModel.GameColumsSize, Mode=OneWay}"
                                MinColumnSpacing="5"
                                MinRowSpacing="5" />
                        </ItemsView.Layout>
                    </ItemsView>
                </Viewbox>
            </Border>
            <StackPanel
                Grid.Column="1"
                Margin="15,0,0,0"
                HorizontalAlignment="Stretch"
                Orientation="Vertical">
                <TextBlock
                    FontFamily="{ThemeResource DefaultFont}"
                    FontSize="18"
                    Text="生成" />
                <Grid Margin="0,5,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition />
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <TextBlock VerticalAlignment="Center" Text="行" />
                    <TextBlock
                        Grid.Column="2"
                        Margin="5,0,0,0"
                        VerticalAlignment="Center"
                        Text="列" />
                    <NumberBox
                        Grid.Column="1"
                        Margin="5,0,0,0"
                        Value="{x:Bind ViewModel.BuildMaxRow, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <NumberBox
                        Grid.Column="3"
                        Margin="5,0,0,0"
                        Value="{x:Bind ViewModel.BuildMaxColumn, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <Button
                        Grid.Row="1"
                        Grid.ColumnSpan="4"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Stretch"
                        Command="{x:Bind ViewModel.GeneratorCustonCommand}"
                        Content="生成" />
                </Grid>
                <TextBlock
                    Margin="0,5,0,0"
                    FontFamily="{ThemeResource DefaultFont}"
                    FontSize="18"
                    Text="基础信息" />
                <TextBox
                    Margin="0,5,0,0"
                    PlaceholderText="题目名称"
                    Text="{x:Bind ViewModel.GameName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <NumberBox
                    Margin="0,5,0,0"
                    PlaceholderText="题目步数"
                    SpinButtonPlacementMode="Compact"
                    Value="{x:Bind ViewModel.GameSetup, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock
                    Margin="0,10,0,0"
                    FontFamily="{ThemeResource DefaultFont}"
                    FontSize="18"
                    Text="操作" />
                <ui1:Segmented
                    Grid.Row="1"
                    Margin="0,10,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    ItemsSource="{x:Bind ViewModel.AvailableColors, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectAvailableColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    SelectionMode="Single">
                    <ui1:Segmented.ItemTemplate>
                        <DataTemplate x:DataType="model:AvailableColor">
                            <Grid Padding="0,10" ToolTipService.ToolTip="{x:Bind Name}">
                                <Border
                                    Width="35"
                                    Height="35"
                                    Background="{x:Bind Color, Mode=OneWay}"
                                    CornerRadius="5" />
                                <FontIcon
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontFamily="{ThemeResource FluentIcon}"
                                    Foreground="White"
                                    Glyph="&#xE72E;"
                                    Visibility="{x:Bind IsStone, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                            </Grid>
                        </DataTemplate>
                    </ui1:Segmented.ItemTemplate>
                    <ui1:Segmented.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ui1:Segmented.ItemsPanel>
                </ui1:Segmented>

                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Button
                        HorizontalAlignment="Stretch"
                        Command="{x:Bind ViewModel.ClearBoardCommand}"
                        Content="清空画板" />
                    <Button
                        Grid.Column="1"
                        Margin="5,0,0,0"
                        HorizontalAlignment="Stretch"
                        Command="{x:Bind ViewModel.FullBlackColorCommand}"
                        Content="填充空白" />
                    <Button
                        Grid.Column="2"
                        Margin="5,0,0,0"
                        HorizontalAlignment="Stretch"
                        Command="{x:Bind ViewModel.ResetCommand}"
                        Content="重置色块" />
                </Grid>
                <TextBlock
                    Margin="0,10,0,0"
                    FontFamily="{ThemeResource DefaultFont}"
                    FontSize="18"
                    Text="设置目标并导出" />
                <ui1:Segmented
                    Margin="0,10,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    ItemsSource="{x:Bind ViewModel.ObjectiveColors, Mode=OneWay}"
                    SelectedItem="{x:Bind ViewModel.SelectGameEndColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    SelectionMode="Single">
                    <ui1:Segmented.ItemTemplate>
                        <DataTemplate x:DataType="model:AvailableColor">
                            <Grid Padding="0,10" ToolTipService.ToolTip="{x:Bind Name}">
                                <Border
                                    Width="35"
                                    Height="35"
                                    Background="{x:Bind Color, Mode=OneWay}"
                                    CornerRadius="5" />
                                <FontIcon
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontFamily="{ThemeResource FluentIcon}"
                                    FontSize="20"
                                    Foreground="White"
                                    Glyph="&#xE72E;"
                                    Visibility="{x:Bind IsStone, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                            </Grid>
                        </DataTemplate>
                    </ui1:Segmented.ItemTemplate>
                    <ui1:Segmented.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ui1:Segmented.ItemsPanel>
                </ui1:Segmented>
                <Grid>
                    <Button
                        Margin="0,10,0,0"
                        HorizontalAlignment="Stretch"
                        Command="{x:Bind ViewModel.SaveGameCommand}"
                        Content="保存" />
                </Grid>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
